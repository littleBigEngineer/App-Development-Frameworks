package com.kylar.KylarsVengeance;

import java.util.List;
import java.util.Scanner;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

import com.kylar.Domain.Equipment;
import com.kylar.Domain.Player;
import com.kylar.Repo.EquipmentRepo;
import com.kylar.Repo.PlayerRepo;
import com.kylar.Service.PlayerService;

@SpringBootApplication(scanBasePackages = {"com.kylar"})
public class KylarsVengeanceApplication implements CommandLineRunner{

	@Autowired
	PlayerRepo playerRepo;

	@Autowired
	PlayerService playerService;

	@Autowired
	EquipmentRepo equipmentRepo;

	Scanner sc = new Scanner(System.in);  
	Player player;
	Equipment equipment;
	String fname = "", lname = "", ign="";
	List<Equipment> equip, sellable;

	public void addPlayer(){
		playerRepo.addPlayer(player);
	}
	
	public void getSellable(){
		sellable = equipmentRepo.getAllSellable();
	}

	public void showMenu(int roundNo){
		int choice;
		do{
			System.out.println("\n=== Round " + roundNo + " ===");
			System.out.println("\n1. Finish Round\n2. Buy new equipment\n3. Sell equipment\n4. Upgrade equipment");
			choice = sc.nextInt();
		}
		while(choice < 0 || choice > 5);

		switch (choice) {
		case 1:  finishRound();
		break;
		case 2:  marketplace(choice);
		break;
		case 3:  marketplace(choice);
		break;
		case 4:  upgrade();
		break;
		}
	}

	private void upgrade() {
		equip = equipmentRepo.getAllEquipment();
		for(int i = 0; i < equip.size(); i++){
			System.out.println(i + ". " + equip.get(i).getItem());
		}
		
		int choice = sc.nextInt();
		
	}

	private void marketplace(int choice) {
		if(choice == 2){ //buy
			
		}
		else{ //sell
			getSellable();
			
			for(int i = 0; i < sellable.size(); i++){
				Equipment eq = sellable.get(i);
				System.out.println(i + ". " + eq.getItem() + " (Levle" + eq.getCurrentLevel() + ") - " + 
				eq.getSalePrice() + "Kubits");
			}
		}
	}

	private void finishRound() {
		// TODO Auto-generated method stub

	}

	public void displayCurrentStats(Player p, Equipment e){
		System.out.println("Current State");
		System.out.println("=============");
		System.out.println("Health: " + player.getHealth() + "%");
		System.out.println("Balance: " + player.getBalance() + " Kubits\n");
		equip = equipmentRepo.getAllEquipment();
		for(Equipment eq : equip){
			System.out.println(eq.getMaterial() + " " + eq.getItem() + " - " + eq.getDurability() 
			+ "/100 - Level " + eq.getCurrentLevel());
		}
	}

	public void getEquipment(){

	}

	@Override
	public void run(String... arg0) throws Exception {
		System.out.print("Enter First Name: ");  
		fname = sc.next();  
		System.out.print("Enter Last Name: ");  
		lname= sc.next();  
		System.out.print("Enter IGN: ");
		ign = sc.next();
		player = new Player(fname,lname,ign,1000,100);

		addPlayer();
		equip = equipmentRepo.getAllEquipment();
		displayCurrentStats(player,equipment);
		for(int i = 1; i <= 10; i++){
			displayCurrentStats(player,equipment);
			showMenu(i);
		}
	}

	public static void main(String[] args) {
		SpringApplication.run(KylarsVengeanceApplication.class, args);
	}
}
